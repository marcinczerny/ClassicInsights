---
import Layout from "@/layouts/Layout.astro";
import { UpdatePasswordForm } from "@/components/auth/UpdatePasswordForm";
---

<Layout title="Update Password | ClassicInsights">
  <div class="flex items-center justify-center min-h-screen">
    <UpdatePasswordForm client:load />
  </div>
</Layout>

<script>
  import { supabaseClient } from "@/db/supabase.client";

  // This handles the session from the password recovery link.
  // The onAuthStateChange listener is triggered when the user is redirected
  // back from Supabase with the session information in the URL hash.
  // We need to ensure the client is initialized and listening for this event
  // as soon as the page loads.
  supabaseClient.auth.onAuthStateChange((event, session) => {
    if (event === "PASSWORD_RECOVERY") {
      // The session is now set, and the UpdatePasswordForm can proceed.
      // No explicit action is needed here other than letting the auth state update.
    }
  });
</script>
